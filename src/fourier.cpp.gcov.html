<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - qucs-core-0.0.19 Code Coverage - src/fourier.cpp</title>
  <link rel="stylesheet" type="text/css" href="../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../index.html">top level</a> - <a href="index.html">src</a> - fourier.cpp<span style="font-size: 80%;"> (source / <a href="fourier.cpp.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">qucs-core-0.0.19 Code Coverage</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">44</td>
            <td class="headerCovTableEntry">168</td>
            <td class="headerCovTableEntryLo">26.2 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2015-01-05 16:01:02</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">2</td>
            <td class="headerCovTableEntry">13</td>
            <td class="headerCovTableEntryLo">15.4 %</td>
          </tr>
          <tr>
            <td class="headerItem">Legend:</td>
            <td class="headerValueLeg">            Lines:
            <span class="coverLegendCov">hit</span>
            <span class="coverLegendNoCov">not hit</span>
            | Branches:
            <span class="coverLegendCov">+</span> taken
            <span class="coverLegendNoCov">-</span> not taken
            <span class="coverLegendNoCov">#</span> not executed
</td>
            <td></td>
            <td class="headerItem">Branches:</td>
            <td class="headerCovTableEntry">23</td>
            <td class="headerCovTableEntry">78</td>
            <td class="headerCovTableEntryLo">29.5 %</td>
          </tr>
          <tr><td><img src="../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">           Branch data     Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>                :            : /*</a>
<span class="lineNum">       2 </span>                :            :  * fourier.cpp - fourier transformation class implementation
<span class="lineNum">       3 </span>                :            :  *
<span class="lineNum">       4 </span>                :            :  * Copyright (C) 2005, 2006, 2009 Stefan Jahn &lt;stefan@lkcc.org&gt;
<span class="lineNum">       5 </span>                :            :  *
<span class="lineNum">       6 </span>                :            :  * This is free software; you can redistribute it and/or modify
<span class="lineNum">       7 </span>                :            :  * it under the terms of the GNU General Public License as published by
<span class="lineNum">       8 </span>                :            :  * the Free Software Foundation; either version 2, or (at your option)
<span class="lineNum">       9 </span>                :            :  * any later version.
<span class="lineNum">      10 </span>                :            :  *
<span class="lineNum">      11 </span>                :            :  * This software is distributed in the hope that it will be useful,
<span class="lineNum">      12 </span>                :            :  * but WITHOUT ANY WARRANTY; without even the implied warranty of
<span class="lineNum">      13 </span>                :            :  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<span class="lineNum">      14 </span>                :            :  * GNU General Public License for more details.
<span class="lineNum">      15 </span>                :            :  *
<span class="lineNum">      16 </span>                :            :  * You should have received a copy of the GNU General Public License
<span class="lineNum">      17 </span>                :            :  * along with this package; see the file COPYING.  If not, write to
<span class="lineNum">      18 </span>                :            :  * the Free Software Foundation, Inc., 51 Franklin Street - Fifth Floor,
<span class="lineNum">      19 </span>                :            :  * Boston, MA 02110-1301, USA.
<span class="lineNum">      20 </span>                :            :  *
<span class="lineNum">      21 </span>                :            :  * $Id$
<span class="lineNum">      22 </span>                :            :  *
<span class="lineNum">      23 </span>                :            :  */
<span class="lineNum">      24 </span>                :            : 
<span class="lineNum">      25 </span>                :            : #if HAVE_CONFIG_H
<span class="lineNum">      26 </span>                :            : # include &lt;config.h&gt;
<span class="lineNum">      27 </span>                :            : #endif
<span class="lineNum">      28 </span>                :            : 
<span class="lineNum">      29 </span>                :            : #include &lt;stdio.h&gt;
<span class="lineNum">      30 </span>                :            : #include &lt;stdlib.h&gt;
<span class="lineNum">      31 </span>                :            : #include &lt;string.h&gt;
<span class="lineNum">      32 </span>                :            : #include &lt;cmath&gt;
<span class="lineNum">      33 </span>                :            : 
<span class="lineNum">      34 </span>                :            : #include &quot;consts.h&quot;
<span class="lineNum">      35 </span>                :            : #include &quot;object.h&quot;
<span class="lineNum">      36 </span>                :            : #include &quot;complex.h&quot;
<span class="lineNum">      37 </span>                :            : #include &quot;vector.h&quot;
<span class="lineNum">      38 </span>                :            : #include &quot;fourier.h&quot;
<span class="lineNum">      39 </span>                :            : 
<span class="lineNum">      40 </span>                :            : // Helper macro.
<span class="lineNum">      41 </span>                :            : #define Swap(a,b) { nr_double_t t; t = a; a = b; b = t; }
<span class="lineNum">      42 </span>                :            : 
<span class="lineNum">      43 </span>                :            : namespace qucs {
<span class="lineNum">      44 </span>                :            : 
<span class="lineNum">      45 </span>                :            : using namespace fourier;
<span class="lineNum">      46 </span>                :            : 
<span class="lineNum">      47 </span>                :            : /* The function performs a 1-dimensional fast fourier transformation.
<a name="48"><span class="lineNum">      48 </span>                :            :    Each data item is meant to be defined in equidistant steps.  The</a>
<span class="lineNum">      49 </span>                :            :    number of data items needs to be of binary size, e.g. 64, 128. */
<span class="lineNum">      50 </span>                :<span class="lineCov">         74 : void fourier::_fft_1d (nr_double_t * data, int len, int isign) {</span>
<span class="lineNum">      51 </span>                :            : 
<span class="lineNum">      52 </span>                :            :   // bit reversal method
<span class="lineNum">      53 </span>                :            :   int i, j, m, n;
<span class="lineNum">      54 </span>                :<span class="lineCov">         74 :   n = 2 * len;</span>
<span class="lineNum">      55 </span>                :<span class="lineCov">         74 :   j = 0;</span>
<span class="lineNum">      56 </span>        [<span class="branchCov" title="Branch 0 was taken 1184 times"> + </span><span class="branchCov" title="Branch 1 was taken 74 times"> + </span>]:<span class="lineCov">       1258 :   for (i = 0; i &lt; n; i += 2) {</span>
<span class="lineNum">      57 </span>        [<span class="branchCov" title="Branch 0 was taken 444 times"> + </span><span class="branchCov" title="Branch 1 was taken 740 times"> + </span>]:<span class="lineCov">       1184 :     if (j &gt; i) {                   // was index already swapped ?</span>
<span class="lineNum">      58 </span>                :<span class="lineCov">        444 :       Swap (data[j], data[i]);     // swap real part</span>
<span class="lineNum">      59 </span>                :<span class="lineCov">        444 :       Swap (data[j+1], data[i+1]); // swap imaginary part</span>
<span class="lineNum">      60 </span>                :            :     }
<span class="lineNum">      61 </span>                :<span class="lineCov">       1184 :     m = len;</span>
<span class="lineNum">      62 </span>[<span class="branchCov" title="Branch 0 was taken 2220 times"> + </span><span class="branchCov" title="Branch 1 was taken 74 times"> + </span>][<span class="branchCov" title="Branch 2 was taken 1110 times"> + </span><span class="branchCov" title="Branch 3 was taken 1110 times"> + </span>]:<span class="lineCov">       2294 :     while (m &gt;= 2 &amp;&amp; j &gt;= m) {     // calculate next swap index</span>
<span class="lineNum">         </span>        [<span class="branchCov" title="Branch 4 was taken 1110 times"> + </span><span class="branchCov" title="Branch 5 was taken 1184 times"> + </span>]
<span class="lineNum">      63 </span>                :<span class="lineCov">       1110 :       j -= m;</span>
<span class="lineNum">      64 </span>                :<span class="lineCov">       1110 :       m &gt;&gt;= 1;</span>
<span class="lineNum">      65 </span>                :            :     }
<span class="lineNum">      66 </span>                :<span class="lineCov">       1184 :     j += m;</span>
<span class="lineNum">      67 </span>                :            :   }
<span class="lineNum">      68 </span>                :            : 
<span class="lineNum">      69 </span>                :            :   // Danielson-Lanzcos algorithm
<span class="lineNum">      70 </span>                :            :   int mmax, istep;
<span class="lineNum">      71 </span>                :            :   nr_double_t wt, th, wr, wi, wpr, wpi, ti, tr;
<span class="lineNum">      72 </span>                :<span class="lineCov">         74 :   mmax = 2;</span>
<span class="lineNum">      73 </span>        [<span class="branchCov" title="Branch 0 was taken 296 times"> + </span><span class="branchCov" title="Branch 1 was taken 74 times"> + </span>]:<span class="lineCov">        370 :   while (n &gt; mmax) {</span>
<span class="lineNum">      74 </span>                :<span class="lineCov">        296 :     istep = mmax &lt;&lt; 1;</span>
<span class="lineNum">      75 </span>                :<span class="lineCov">        296 :     th = isign * (2 * M_PI / mmax);</span>
<span class="lineNum">      76 </span>                :<span class="lineCov">        296 :     wt = sin (0.5 * th);</span>
<span class="lineNum">      77 </span>                :<span class="lineCov">        296 :     wpr = -2.0 * wt * wt;</span>
<span class="lineNum">      78 </span>                :<span class="lineCov">        296 :     wpi = sin (th);</span>
<span class="lineNum">      79 </span>                :<span class="lineCov">        296 :     wr = 1.0;</span>
<span class="lineNum">      80 </span>                :<span class="lineCov">        296 :     wi = 0.0;</span>
<span class="lineNum">      81 </span>        [<span class="branchCov" title="Branch 0 was taken 1110 times"> + </span><span class="branchCov" title="Branch 1 was taken 296 times"> + </span>]:<span class="lineCov">       1406 :     for (m = 1; m &lt; mmax; m += 2) {</span>
<span class="lineNum">      82 </span>        [<span class="branchCov" title="Branch 0 was taken 2368 times"> + </span><span class="branchCov" title="Branch 1 was taken 1110 times"> + </span>]:<span class="lineCov">       3478 :       for (i = m; i &lt;= n; i += istep) {</span>
<span class="lineNum">      83 </span>                :<span class="lineCov">       2368 :         j = i + mmax;</span>
<span class="lineNum">      84 </span>                :<span class="lineCov">       2368 :         tr = wr * data[j] - wi * data[j-1];</span>
<span class="lineNum">      85 </span>                :<span class="lineCov">       2368 :         ti = wr * data[j-1] + wi * data[j];</span>
<span class="lineNum">      86 </span>                :<span class="lineCov">       2368 :         data[j] = data[i] - tr;</span>
<span class="lineNum">      87 </span>                :<span class="lineCov">       2368 :         data[j-1] = data[i-1] - ti;</span>
<span class="lineNum">      88 </span>                :<span class="lineCov">       2368 :         data[i] += tr;</span>
<span class="lineNum">      89 </span>                :<span class="lineCov">       2368 :         data[i-1] += ti;</span>
<span class="lineNum">      90 </span>                :            :       }
<span class="lineNum">      91 </span>                :<span class="lineCov">       1110 :       wr = (wt = wr) * wpr - wi * wpi + wr;</span>
<span class="lineNum">      92 </span>                :<span class="lineCov">       1110 :       wi = wi * wpr + wt * wpi + wi;</span>
<span class="lineNum">      93 </span>                :            :     }
<span class="lineNum">      94 </span>                :<span class="lineCov">        296 :     mmax = istep;</span>
<span class="lineNum">      95 </span>                :            :   }
<span class="lineNum">      96 </span>                :<span class="lineCov">         74 : }</span>
<span class="lineNum">      97 </span>                :            : 
<a name="98"><span class="lineNum">      98 </span>                :            : /* The function transforms two real vectors using a single fast</a>
<span class="lineNum">      99 </span>                :            :    fourier transformation step.  The routine works in place. */
<span class="lineNum">     100 </span>                :<span class="lineNoCov">          0 : void fourier::_fft_1d_2r (nr_double_t * r1, nr_double_t * r2, int len) {</span>
<span class="lineNum">     101 </span>                :            :   int n3, n2, j;
<span class="lineNum">     102 </span>                :            :   nr_double_t rep, rem, aip, aim;
<span class="lineNum">     103 </span>                :<span class="lineNoCov">          0 :   n3 = 1 + (n2 = len + len);</span>
<span class="lineNum">     104 </span>                :            : 
<span class="lineNum">     105 </span>                :            :   // put the two real vectors into one complex vector
<span class="lineNum">     106 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (j = 1; j &lt;= n2; j += 2) {</span>
<span class="lineNum">     107 </span>                :<span class="lineNoCov">          0 :     r1[j] = r2[j-1];</span>
<span class="lineNum">     108 </span>                :            :   }
<span class="lineNum">     109 </span>                :            : 
<span class="lineNum">     110 </span>                :            :   // transform the complex vector
<span class="lineNum">     111 </span>                :<span class="lineNoCov">          0 :   _fft_1d (r1, len, 1);</span>
<span class="lineNum">     112 </span>                :            : 
<span class="lineNum">     113 </span>                :            :   // separate the two transforms
<span class="lineNum">     114 </span>                :<span class="lineNoCov">          0 :   r2[0] = r1[1];</span>
<span class="lineNum">     115 </span>                :<span class="lineNoCov">          0 :   r1[1] = r2[1] = 0.0;</span>
<span class="lineNum">     116 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (j = 2; j &lt;= len; j += 2) {</span>
<span class="lineNum">     117 </span>                :            :     // use symmetries to separate the two transforms
<span class="lineNum">     118 </span>                :<span class="lineNoCov">          0 :     rep = 0.5 * (r1[j] + r1[n2-j]);</span>
<span class="lineNum">     119 </span>                :<span class="lineNoCov">          0 :     rem = 0.5 * (r1[j] - r1[n2-j]);</span>
<span class="lineNum">     120 </span>                :<span class="lineNoCov">          0 :     aip = 0.5 * (r1[j+1] + r1[n3-j]);</span>
<span class="lineNum">     121 </span>                :<span class="lineNoCov">          0 :     aim = 0.5 * (r1[j+1] - r1[n3-j]);</span>
<span class="lineNum">     122 </span>                :            :     // ship them out in two complex vectors
<span class="lineNum">     123 </span>                :<span class="lineNoCov">          0 :     r1[j+1] = aim;</span>
<span class="lineNum">     124 </span>                :<span class="lineNoCov">          0 :     r2[j+1] = -rem;</span>
<span class="lineNum">     125 </span>                :<span class="lineNoCov">          0 :     r1[j] = r1[n2-j] = rep;</span>
<span class="lineNum">     126 </span>                :<span class="lineNoCov">          0 :     r2[j] = r2[n2-j] = aip;</span>
<span class="lineNum">     127 </span>                :<span class="lineNoCov">          0 :     r1[n3-j] = -aim;</span>
<span class="lineNum">     128 </span>                :<span class="lineNoCov">          0 :     r2[n3-j] = rem;</span>
<span class="lineNum">     129 </span>                :            :   }
<span class="lineNum">     130 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     131 </span>                :            : 
<span class="lineNum">     132 </span>                :            : /* The following function transforms two vectors yielding real valued
<a name="133"><span class="lineNum">     133 </span>                :            :    vectors using a single inverse fast fourier transformation step.</a>
<span class="lineNum">     134 </span>                :            :    The routine works in place as well. */
<span class="lineNum">     135 </span>                :<span class="lineNoCov">          0 : void fourier::_ifft_1d_2r (nr_double_t * r1, nr_double_t * r2, int len) {</span>
<span class="lineNum">     136 </span>                :            :   nr_double_t r, i;
<span class="lineNum">     137 </span>                :<span class="lineNoCov">          0 :   int j, jj, nn = len + len;</span>
<span class="lineNum">     138 </span>                :            : 
<span class="lineNum">     139 </span>                :            :   // put the two complex vectors into one complex vector
<span class="lineNum">     140 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (j = 0, jj = 0; j &lt; nn; j += 2) {</span>
<span class="lineNum">     141 </span>                :<span class="lineNoCov">          0 :     r = r1[j] - r2[j+1];</span>
<span class="lineNum">     142 </span>                :<span class="lineNoCov">          0 :     i = r1[j+1] + r2[j];</span>
<span class="lineNum">     143 </span>                :<span class="lineNoCov">          0 :     r1[jj++] = r;</span>
<span class="lineNum">     144 </span>                :<span class="lineNoCov">          0 :     r1[jj++] = i;</span>
<span class="lineNum">     145 </span>                :            :   }
<span class="lineNum">     146 </span>                :            : 
<span class="lineNum">     147 </span>                :            :   // transform the complex vector
<span class="lineNum">     148 </span>                :<span class="lineNoCov">          0 :   _fft_1d (r1, len, -1);</span>
<span class="lineNum">     149 </span>                :            : 
<span class="lineNum">     150 </span>                :            :   // split the transforms into two real vectors
<span class="lineNum">     151 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (j = 0; j &lt; nn; j += 2) {</span>
<span class="lineNum">     152 </span>                :<span class="lineNoCov">          0 :     r2[j] = r1[j+1];</span>
<span class="lineNum">     153 </span>                :<span class="lineNoCov">          0 :     r1[j+1] = r2[j+1] = 0.0;</span>
<span class="lineNum">     154 </span>                :            :   }
<span class="lineNum">     155 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     156 </span>                :            : 
<span class="lineNum">     157 </span>                :            : /* This function performs a 1-dimensional fast fourier transformation
<span class="lineNum">     158 </span>                :            :    on the given vector 'var'.  If 'sign' is -1 the inverse fft is
<a name="159"><span class="lineNum">     159 </span>                :            :    computed, if +1 the fft itself is computed.  It returns a vector of</a>
<span class="lineNum">     160 </span>                :            :    binary size (as necessary for a fft). */
<span class="lineNum">     161 </span>                :<span class="lineNoCov">          0 : vector fourier::fft_1d (vector var, int isign) {</span>
<span class="lineNum">     162 </span>                :<span class="lineNoCov">          0 :   int i, n, len = var.getSize ();</span>
<span class="lineNum">     163 </span>                :            : 
<span class="lineNum">     164 </span>                :            :   // compute necessary binary data array size
<span class="lineNum">     165 </span>                :<span class="lineNoCov">          0 :   int size = 2;</span>
<span class="lineNum">     166 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   while (size &lt; len) size &lt;&lt;= 1;</span>
<span class="lineNum">     167 </span>                :            : 
<span class="lineNum">     168 </span>                :            :   // put data items (temporary array) in place
<span class="lineNum">     169 </span>                :            :   nr_double_t * data;
<span class="lineNum">     170 </span>                :<span class="lineNoCov">          0 :   data = (nr_double_t *) calloc (2 * size * sizeof (nr_double_t), 1);</span>
<span class="lineNum">     171 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (n = i = 0; i &lt; len; i++, n += 2) {</span>
<span class="lineNum">     172 </span>                :<span class="lineNoCov">          0 :     data[n] = real (var (i)); data[n+1] = imag (var (i));</span>
<span class="lineNum">     173 </span>                :            :   }
<span class="lineNum">     174 </span>                :            : 
<span class="lineNum">     175 </span>                :            :   // run 1-dimensional fft
<span class="lineNum">     176 </span>                :<span class="lineNoCov">          0 :   _fft_1d (data, size, isign);</span>
<span class="lineNum">     177 </span>                :            : 
<span class="lineNum">     178 </span>                :            :   // store transformed data items in result vector
<span class="lineNum">     179 </span>                :<span class="lineNoCov">          0 :   vector res = vector (size);</span>
<span class="lineNum">     180 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (n = i = 0; i &lt; size; i++, n += 2) {</span>
<span class="lineNum">     181 </span>                :<span class="lineNoCov">          0 :     res (i) = nr_complex_t (data[n], data[n+1]);</span>
<span class="lineNum">     182 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :     if (isign &lt; 0) res (i) /= size;</span>
<span class="lineNum">     183 </span>                :            :   }
<span class="lineNum">     184 </span>                :            : 
<span class="lineNum">     185 </span>                :            :   // free temporary data array
<span class="lineNum">     186 </span>                :<span class="lineNoCov">          0 :   free (data);</span>
<span class="lineNum">     187 </span>                :<span class="lineNoCov">          0 :   return res;</span>
<span class="lineNum">     188 </span>                :            : }
<span class="lineNum">     189 </span>                :            : 
<span class="lineNum">     190 </span>                :            : /* The function performs a 1-dimensional discrete fourier
<a name="191"><span class="lineNum">     191 </span>                :            :    transformation.  Each data item is meant to be defined in</a>
<span class="lineNum">     192 </span>                :            :    equidistant steps. */
<span class="lineNum">     193 </span>                :<span class="lineNoCov">          0 : void fourier::_dft_1d (nr_double_t * data, int len, int isign) {</span>
<span class="lineNum">     194 </span>                :<span class="lineNoCov">          0 :   int k, n, size = 2 * len * sizeof (nr_double_t);</span>
<span class="lineNum">     195 </span>                :<span class="lineNoCov">          0 :   nr_double_t * res = (nr_double_t *) calloc (size, 1);</span>
<span class="lineNum">     196 </span>                :            :   nr_double_t th, c, s;
<span class="lineNum">     197 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (n = 0; n &lt; 2 * len; n += 2) {</span>
<span class="lineNum">     198 </span>                :<span class="lineNoCov">          0 :     th = n * M_PI / 2 / len;</span>
<span class="lineNum">     199 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :     for (k = 0; k &lt; 2 * len; k += 2) {</span>
<span class="lineNum">     200 </span>                :<span class="lineNoCov">          0 :       c = cos (k * th);</span>
<span class="lineNum">     201 </span>                :<span class="lineNoCov">          0 :       s = isign * sin (k * th);</span>
<span class="lineNum">     202 </span>                :<span class="lineNoCov">          0 :       res[n] += data[k] * c + data[k+1] * s;</span>
<span class="lineNum">     203 </span>                :<span class="lineNoCov">          0 :       res[n+1] += data[k+1] * c - data[k] * s;</span>
<span class="lineNum">     204 </span>                :            :     }
<span class="lineNum">     205 </span>                :            :   }
<span class="lineNum">     206 </span>                :<span class="lineNoCov">          0 :   memcpy (data, res, size);</span>
<span class="lineNum">     207 </span>                :<span class="lineNoCov">          0 :   free (res);</span>
<span class="lineNum">     208 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     209 </span>                :            : 
<span class="lineNum">     210 </span>                :            : /* The function performs a 1-dimensional discrete fourier
<a name="211"><span class="lineNum">     211 </span>                :            :    transformation on the given vector 'var'.  If 'sign' is -1 the</a>
<span class="lineNum">     212 </span>                :            :    inverse dft is computed, if +1 the dft itself is computed. */
<span class="lineNum">     213 </span>                :<span class="lineCov">          3 : vector fourier::dft_1d (vector var, int isign) {</span>
<span class="lineNum">     214 </span>                :<span class="lineCov">          3 :   int k, n, len = var.getSize ();</span>
<span class="lineNum">     215 </span>                :<span class="lineCov">          3 :   vector res = vector (len);</span>
<span class="lineNum">     216 </span>        [<span class="branchCov" title="Branch 0 was taken 858 times"> + </span><span class="branchCov" title="Branch 1 was taken 3 times"> + </span>]:<span class="lineCov">        861 :   for (n = 0; n &lt; len; n++) {</span>
<span class="lineNum">     217 </span>                :<span class="lineCov">        858 :     nr_double_t th = - isign * 2 * M_PI * n / len;</span>
<span class="lineNum">     218 </span>                :<span class="lineCov">        858 :     nr_complex_t val = 0;</span>
<span class="lineNum">     219 </span>        [<span class="branchCov" title="Branch 0 was taken 266738 times"> + </span><span class="branchCov" title="Branch 1 was taken 858 times"> + </span>]:<span class="lineCov">     267596 :     for (k = 0; k &lt; len; k++)</span>
<span class="lineNum">     220 </span>        [<span class="branchCov" title="Branch 2 was taken 266738 times"> + </span><span class="branchNoCov" title="Branch 3 was not taken"> - </span>]:<span class="lineCov">     266738 :       val += var (k) * std::polar (1.0, th * k);</span>
<span class="lineNum">     221 </span>[<span class="branchNoCov" title="Branch 1 was not taken"> - </span><span class="branchCov" title="Branch 2 was taken 858 times"> + </span>][<span class="branchNoCov" title="Branch 4 was not taken"> - </span><span class="branchCov" title="Branch 5 was taken 858 times"> + </span>]:<span class="lineCov">        858 :     res (n) = isign &lt; 0 ? val / (nr_double_t) len : val;</span>
<span class="lineNum">     222 </span>                :            :   }
<span class="lineNum">     223 </span>                :<span class="lineCov">          3 :   return res;</span>
<span class="lineNum">     224 </span>                :            : }
<a name="225"><span class="lineNum">     225 </span>                :            : </a>
<span class="lineNum">     226 </span>                :            : // Helper functions.
<span class="lineNum">     227 </span>                :<span class="lineNoCov">          0 : vector fourier::ifft_1d (vector var) {</span>
<a name="228"><span class="lineNum">     228 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   return fft_1d (var, -1);</span></a>
<span class="lineNum">     229 </span>                :            : }
<span class="lineNum">     230 </span>                :<span class="lineNoCov">          0 : vector fourier::idft_1d (vector var) {</span>
<a name="231"><span class="lineNum">     231 </span>        [<span class="branchNoExec" title="Branch 1 was not executed"> # </span><span class="branchNoExec" title="Branch 2 was not executed"> # </span>]:<span class="lineNoCov">          0 :   return dft_1d (var, -1);</span></a>
<span class="lineNum">     232 </span>                :            : }
<span class="lineNum">     233 </span>                :<span class="lineNoCov">          0 : void fourier::_ifft_1d (nr_double_t * data, int len) {</span>
<a name="234"><span class="lineNum">     234 </span>                :<span class="lineNoCov">          0 :   _fft_1d (data, len, -1);</span></a>
<span class="lineNum">     235 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     236 </span>                :<span class="lineNoCov">          0 : void fourier::_idft_1d (nr_double_t * data, int len) {</span>
<span class="lineNum">     237 </span>                :<span class="lineNoCov">          0 :   _dft_1d (data, len, -1);</span>
<span class="lineNum">     238 </span>                :<span class="lineNoCov">          0 : }</span>
<span class="lineNum">     239 </span>                :            : 
<span class="lineNum">     240 </span>                :            : /* The function performs a n-dimensional fast fourier transformation.
<span class="lineNum">     241 </span>                :            :    Each data item is meant to be defined in equidistant steps.  The
<a name="242"><span class="lineNum">     242 </span>                :            :    number of data items needs to be of binary size, e.g. 64, 128 for</a>
<span class="lineNum">     243 </span>                :            :    each dimension. */
<span class="lineNum">     244 </span>                :<span class="lineNoCov">          0 : void fourier::_fft_nd (nr_double_t * data, int len[], int nd, int isign) {</span>
<span class="lineNum">     245 </span>                :            : 
<span class="lineNum">     246 </span>                :            :  int i, i1, i2, i3, i2rev, i3rev, ip1, ip2, ip3, ifp1, ifp2;
<span class="lineNum">     247 </span>                :            :  int ibit, k1, k2, n, np, nr, nt;
<span class="lineNum">     248 </span>                :            : 
<span class="lineNum">     249 </span>                :            :  // compute total number of complex values
<span class="lineNum">     250 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :  for (nt = 1, i = 0; i &lt; nd; i++) nt *= len[i];</span>
<span class="lineNum">     251 </span>                :            : 
<span class="lineNum">     252 </span>                :            :  // main loop over the dimensions
<span class="lineNum">     253 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :  for (np = 1, i = nd - 1; i &gt;= 0; i--) {</span>
<span class="lineNum">     254 </span>                :<span class="lineNoCov">          0 :    n = len[i];</span>
<span class="lineNum">     255 </span>                :<span class="lineNoCov">          0 :    nr = nt / (n * np);</span>
<span class="lineNum">     256 </span>                :<span class="lineNoCov">          0 :    ip1 = np &lt;&lt; 1;</span>
<span class="lineNum">     257 </span>                :<span class="lineNoCov">          0 :    ip2 = ip1 * n;</span>
<span class="lineNum">     258 </span>                :<span class="lineNoCov">          0 :    ip3 = ip2 * nr;</span>
<span class="lineNum">     259 </span>                :            : 
<span class="lineNum">     260 </span>                :            :    // bit-reversal method
<span class="lineNum">     261 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :    for (i2rev = 1, i2 = 1; i2 &lt;= ip2; i2 += ip1) {</span>
<span class="lineNum">     262 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :      if (i2 &lt; i2rev) {</span>
<span class="lineNum">     263 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :        for (i1 = i2; i1 &lt;= i2 + ip1 - 2; i1 += 2) {</span>
<span class="lineNum">     264 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :          for (i3 = i1; i3 &lt;= ip3; i3 += ip2) {</span>
<span class="lineNum">     265 </span>                :<span class="lineNoCov">          0 :            i3rev = i2rev + i3 - i2;</span>
<span class="lineNum">     266 </span>                :<span class="lineNoCov">          0 :            Swap (data[i3-1], data[i3rev-1]);</span>
<span class="lineNum">     267 </span>                :<span class="lineNoCov">          0 :            Swap (data[i3], data[i3rev]);</span>
<span class="lineNum">     268 </span>                :            :          }
<span class="lineNum">     269 </span>                :            :        }
<span class="lineNum">     270 </span>                :            :      }
<span class="lineNum">     271 </span>                :<span class="lineNoCov">          0 :      ibit = ip2 &gt;&gt; 1;</span>
<span class="lineNum">     272 </span>[<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>][<span class="branchNoExec" title="Branch 2 was not executed"> # </span><span class="branchNoExec" title="Branch 3 was not executed"> # </span>]:<span class="lineNoCov">          0 :      while (ibit &gt;= ip1 &amp;&amp; i2rev &gt; ibit) {</span>
<span class="lineNum">         </span>        [<span class="branchNoExec" title="Branch 4 was not executed"> # </span><span class="branchNoExec" title="Branch 5 was not executed"> # </span>]
<span class="lineNum">     273 </span>                :<span class="lineNoCov">          0 :        i2rev -= ibit;</span>
<span class="lineNum">     274 </span>                :<span class="lineNoCov">          0 :        ibit &gt;&gt;= 1;</span>
<span class="lineNum">     275 </span>                :            :      }
<span class="lineNum">     276 </span>                :<span class="lineNoCov">          0 :      i2rev += ibit;</span>
<span class="lineNum">     277 </span>                :            :    }
<span class="lineNum">     278 </span>                :            : 
<span class="lineNum">     279 </span>                :            :    // Danielson-Lanzcos algorithm
<span class="lineNum">     280 </span>                :            :    nr_double_t ti, tr, wt, th, wr, wi, wpi, wpr;
<span class="lineNum">     281 </span>                :<span class="lineNoCov">          0 :    ifp1 = ip1;</span>
<span class="lineNum">     282 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :    while (ifp1 &lt; ip2) {</span>
<span class="lineNum">     283 </span>                :<span class="lineNoCov">          0 :      ifp2 = ifp1 &lt;&lt; 1;</span>
<span class="lineNum">     284 </span>                :<span class="lineNoCov">          0 :      th = isign * 2 * M_PI / (ifp2 / ip1);</span>
<span class="lineNum">     285 </span>                :<span class="lineNoCov">          0 :      wt = sin (0.5 * th);</span>
<span class="lineNum">     286 </span>                :<span class="lineNoCov">          0 :      wpr = -2.0 * wt * wt;</span>
<span class="lineNum">     287 </span>                :<span class="lineNoCov">          0 :      wpi = sin (th);</span>
<span class="lineNum">     288 </span>                :<span class="lineNoCov">          0 :      wr = 1.0;</span>
<span class="lineNum">     289 </span>                :<span class="lineNoCov">          0 :      wi = 0.0;</span>
<span class="lineNum">     290 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :      for (i3 = 1; i3 &lt;= ifp1; i3 += ip1) {</span>
<span class="lineNum">     291 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :        for (i1 = i3; i1 &lt;= i3 + ip1 - 2; i1 += 2) {</span>
<span class="lineNum">     292 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :          for (i2 = i1; i2 &lt;= ip3; i2 += ifp2) {</span>
<span class="lineNum">     293 </span>                :<span class="lineNoCov">          0 :            k1 = i2;</span>
<span class="lineNum">     294 </span>                :<span class="lineNoCov">          0 :            k2 = k1 + ifp1;</span>
<span class="lineNum">     295 </span>                :<span class="lineNoCov">          0 :            tr = wr * data[k2-1] - wi * data[k2];</span>
<span class="lineNum">     296 </span>                :<span class="lineNoCov">          0 :            ti = wr * data[k2] + wi * data[k2-1];</span>
<span class="lineNum">     297 </span>                :<span class="lineNoCov">          0 :            data[k2-1] = data[k1-1] - tr;</span>
<span class="lineNum">     298 </span>                :<span class="lineNoCov">          0 :            data[k2] = data[k1] - ti;</span>
<span class="lineNum">     299 </span>                :<span class="lineNoCov">          0 :            data[k1-1] += tr;</span>
<span class="lineNum">     300 </span>                :<span class="lineNoCov">          0 :            data[k1] += ti;</span>
<span class="lineNum">     301 </span>                :            :          }
<span class="lineNum">     302 </span>                :            :        }
<span class="lineNum">     303 </span>                :<span class="lineNoCov">          0 :        wr = (wt = wr) * wpr - wi * wpi + wr;</span>
<span class="lineNum">     304 </span>                :<span class="lineNoCov">          0 :        wi = wi * wpr + wt * wpi + wi;</span>
<span class="lineNum">     305 </span>                :            :      }
<span class="lineNum">     306 </span>                :<span class="lineNoCov">          0 :      ifp1 = ifp2;</span>
<span class="lineNum">     307 </span>                :            :    }
<span class="lineNum">     308 </span>                :<span class="lineNoCov">          0 :    np *= n;</span>
<span class="lineNum">     309 </span>                :            :  }
<span class="lineNum">     310 </span>                :<span class="lineNoCov">          0 : }</span>
<a name="311"><span class="lineNum">     311 </span>                :            : </a>
<span class="lineNum">     312 </span>                :            : // Helper functions.
<span class="lineNum">     313 </span>                :<span class="lineNoCov">          0 : void fourier::_ifft_nd (nr_double_t * data, int len[], int nd) {</span>
<span class="lineNum">     314 </span>                :<span class="lineNoCov">          0 :   _fft_nd (data, len, nd, -1);</span>
<span class="lineNum">     315 </span>                :<span class="lineNoCov">          0 : }</span>
<a name="316"><span class="lineNum">     316 </span>                :            : </a>
<span class="lineNum">     317 </span>                :            : // Shuffles values of FFT around.
<span class="lineNum">     318 </span>                :<span class="lineNoCov">          0 : vector fourier::fftshift (vector var) {</span>
<span class="lineNum">     319 </span>                :<span class="lineNoCov">          0 :   int i, n, len = var.getSize ();</span>
<span class="lineNum">     320 </span>                :<span class="lineNoCov">          0 :   vector res = vector (len);</span>
<span class="lineNum">     321 </span>                :<span class="lineNoCov">          0 :   n = len / 2;</span>
<span class="lineNum">     322 </span>        [<span class="branchNoExec" title="Branch 0 was not executed"> # </span><span class="branchNoExec" title="Branch 1 was not executed"> # </span>]:<span class="lineNoCov">          0 :   for (i = 0; i &lt; len / 2; i++) {</span>
<span class="lineNum">     323 </span>                :<span class="lineNoCov">          0 :     res (i) = var (n + i);</span>
<span class="lineNum">     324 </span>                :<span class="lineNoCov">          0 :     res (i + n) = var (i);</span>
<span class="lineNum">     325 </span>                :            :   }
<span class="lineNum">     326 </span>                :<span class="lineNoCov">          0 :   return res;</span>
<span class="lineNum">     327 </span>                :            : }
<span class="lineNum">     328 </span>                :            : 
<span class="lineNum">     329 </span>                :            : } // namespace qucs
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
